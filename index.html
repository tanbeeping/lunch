<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eh, Eat What? üçîüç±üçúüçïü•ò</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;900&display=swap');

        :root {
            --primary: #549e24;
            --primary-soft: #c5e7b2;
            --bg-color: #dcedc8;
            --accent: #000000;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg-color); 
        }

        .neo-card { 
            background: white; 
            border: 4px solid var(--accent); 
            box-shadow: 8px 8px 0px 0px var(--accent); 
        }

        .neo-button { 
            background-color: var(--primary); 
            color: white;
            border: 3px solid var(--accent); 
            box-shadow: 4px 4px 0px 0px var(--accent); 
            transition: all 0.1s; 
        }

        .neo-button:active:not(:disabled) { 
            box-shadow: 0px 0px 0px 0px var(--accent); 
            transform: translate(4px, 4px); 
        }

        .tag-base {
            border: 2px solid var(--accent); 
            padding: 2px 8px;
            font-size: 10px; 
            font-weight: 900; 
            text-transform: uppercase;
        }

        /* Darker Overlay Style */
        .modal-overlay {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Darker backdrop */
            backdrop-filter: blur(4px);
            z-index: 50; 
            align-items: center; 
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }

        .loading-shimmer { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full">
        <div class="neo-card rounded-3xl p-8 mb-6">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-900 uppercase tracking-tighter italic leading-none">Eh, Eat What?</h1>
                <div id="status-dot" class="inline-flex items-center gap-2 mt-2">
                    <span class="w-2 h-2 bg-gray-400 rounded-full loading-shimmer"></span>
                    <span class="text-[10px] font-black uppercase opacity-60">Syncing...</span>
                </div>
            </header>

            <div id="display-container" class="border-4 border-black rounded-2xl p-6 mb-8 min-h-[160px] flex flex-col items-center justify-center text-center" style="background-color: var(--primary-soft);">
                <div id="chosen-name" class="text-3xl font-black leading-tight mb-2">Feeding Data...</div>
                <div id="meta-tags" class="flex flex-wrap justify-center gap-2 mt-2 opacity-0 transition-opacity">
                    <span id="tag-halal" class="tag-base bg-white"></span>
                    <span id="tag-loc" class="tag-base bg-white"></span>
                    <span id="tag-type" class="tag-base bg-white"></span>
                </div>
            </div>

            <div class="space-y-4 mb-8">
                <div class="flex items-center gap-4">
                    <label class="w-20 font-black text-xs uppercase">Where</label>
                    <select id="f-loc" class="flex-1 bg-white border-2 border-black rounded-lg p-2 font-bold text-sm outline-none">
                        <option value="any">Anywhere</option>
                        <option value="Campus">Campus</option>
                        <option value="Outside">Outside</option>
                    </select>
                </div>
                <div class="flex items-center gap-4">
                    <label class="w-20 font-black text-xs uppercase">Cuisine</label>
                    <select id="f-type" class="flex-1 bg-white border-2 border-black rounded-lg p-2 font-bold text-sm outline-none">
                        <option value="any">Anything</option>
                        <option value="Asian">Asian</option>
                        <option value="Western">Western</option>
                        <option value="Fast Food">Fast Food</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Desserts">Desserts</option>
                        <option value="Others">Others</option>
                    </select>
                </div>
                <div class="flex items-center gap-4">
                    <label class="w-20 font-black text-xs uppercase leading-tight">Dietary</label>
                    <select id="f-diet" class="flex-1 bg-white border-2 border-black rounded-lg p-2 font-bold text-sm outline-none">
                        <option value="any">No Preference</option>
                        <option value="halal">Halal</option>
                        <option value="vegetarian">Vegetarian</option>
                    </select>
                </div>
            </div>

            <button id="spin-btn" disabled onclick="spin()" class="neo-button w-full py-4 rounded-xl uppercase tracking-widest">
                <div class="text-2xl font-black mb-0">Spin Now</div>
                <div class="text-[10px] opacity-90 font-bold">(before the committee decides)</div>
            </button>
        </div>

        <button onclick="toggleModal('add-modal')" class="neo-card w-full bg-white hover:bg-emerald-50 p-4 rounded-2xl flex items-center justify-between transition-colors mb-4 group">
            <span class="font-black text-sm uppercase group-hover:text-[var(--primary)] text-left leading-tight">
                Found a new place? <br>
                <span class="text-[10px] opacity-60 font-bold">Suggest a new spot, don't gatekeep leh!</span>
            </span>
            <span class="text-3xl font-black">+</span>
        </button>

        <div class="flex justify-between items-center px-2">
            <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8rEkvss_C8OAw0mcM-Gdjk_1u-3KvxYKjAB7vBi5m6cfn-5qtoee2aozKpY4Ib1PqVPxb3rySDGUa/pubhtml?gid=0&single=true" target="_blank" class="text-[10px] font-bold opacity-60 uppercase hover:opacity-100 italic">View Full List ‚Üó</a>
            <button onclick="toggleModal('feedback-modal')" class="text-[10px] font-bold opacity-60 uppercase hover:opacity-100 italic">Report Error / Feedback</button>
        </div>
    </div>

    <div id="add-modal" class="modal-overlay" onclick="closeOnOverlay(event, 'add-modal')">
        <div class="neo-card w-full max-w-sm p-6 rounded-2xl relative">
            <button onclick="toggleModal('add-modal')" class="absolute top-4 right-4 font-black text-xl">‚úï</button>
            <h2 class="text-xl font-black uppercase mb-4">Suggest a Spot</h2>
            <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSeuhj2rNRjuISCw-ECcQVDQmRuJGJLoUOCGP3nGZ7GBe0u4UA/viewform?embedded=true" width="100%" height="450" frameborder="0" marginheight="0" marginwidth="0">Loading‚Ä¶</iframe>
        </div>
    </div>

    <div id="feedback-modal" class="modal-overlay" onclick="closeOnOverlay(event, 'feedback-modal')">
        <div class="neo-card w-full max-w-sm p-6 rounded-2xl relative">
            <button onclick="toggleModal('feedback-modal')" class="absolute top-4 right-4 font-black text-xl">‚úï</button>
            <h2 class="text-xl font-black uppercase mb-4">Feedback</h2>
            <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSckUBegUweAa5XHZpbCrVnsWBTfH40EhC2PHr7kqimubBWc_Q/viewform?embedded=true" width="100%" height="300" frameborder="0" marginheight="0" marginwidth="0">Loading‚Ä¶</iframe>
        </div>
    </div>

    <script>
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8rEkvss_C8OAw0mcM-Gdjk_1u-3KvxYKjAB7vBi5m6cfn-5qtoee2aozKpY4Ib1PqVPxb3rySDGUa/pub?gid=0&single=true&output=csv";
        let foodData = [];

        function toggleModal(id) {
            document.getElementById(id).classList.toggle('active');
        }

        function closeOnOverlay(e, id) {
            if (e.target.id === id) toggleModal(id);
        }

        async function init() {
            try {
                const response = await fetch(SHEET_CSV_URL + "&cache=" + Date.now());
                const csvText = await response.text();
                const rows = csvText.split(/\r?\n/).slice(1); 
                
                foodData = rows.map(row => {
                    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return {
                        name: cols[0]?.replace(/^"|"$/g, '').trim(),
                        loc: cols[1]?.replace(/^"|"$/g, '').trim(),
                        type: cols[2]?.replace(/^"|"$/g, '').trim(),
                        diet: cols[3]?.replace(/^"|"$/g, '').trim().toLowerCase()
                    };
                }).filter(item => item.name && item.name.length > 1);

                document.getElementById('status-dot').innerHTML = `
                    <span class="w-2 h-2 bg-green-600 rounded-full"></span>
                    <span class="text-[10px] font-black uppercase opacity-60">Live: ${foodData.length} Spots</span>`;
                
                document.getElementById('spin-btn').disabled = false;
                document.getElementById('chosen-name').innerText = "Makan?";
            } catch (err) {
                document.getElementById('chosen-name').innerText = "Sync Error!";
            }
        }

        function spin() {
            const fLoc = document.getElementById('f-loc').value;
            const fType = document.getElementById('f-type').value;
            const fDiet = document.getElementById('f-diet').value;

            const pool = foodData.filter(item => {
                const lMatch = fLoc === 'any' || item.loc === fLoc;
                const tMatch = fType === 'any' || item.type.toLowerCase().includes(fType.toLowerCase());
                const dMatch = fDiet === 'any' || (item.diet && item.diet.toLowerCase().includes(fDiet.toLowerCase()));
                return lMatch && tMatch && dMatch;
            });

            const display = document.getElementById('chosen-name');
            const meta = document.getElementById('meta-tags');

            if (pool.length === 0) {
                display.innerText = "No Matches! üò≠";
                meta.style.opacity = "0";
                return;
            }

            let count = 0;
            const timer = setInterval(() => {
                display.innerText = pool[Math.floor(Math.random() * pool.length)].name;
                count++;
                if (count > 12) {
                    clearInterval(timer);
                    const final = pool[Math.floor(Math.random() * pool.length)];
                    display.innerText = final.name;
                    
                    const dietTag = document.getElementById('tag-halal');
                    if (final.diet && final.diet.trim() !== "") {
                        dietTag.innerText = final.diet.split(',').map(s => s.trim().charAt(0).toUpperCase() + s.trim().slice(1)).join(' & ');
                        dietTag.style.display = "inline-block";
                    } else {
                        dietTag.style.display = "none";
                    }
                    document.getElementById('tag-loc').innerText = final.loc;
                    document.getElementById('tag-type').innerText = final.type;
                    meta.style.opacity = "1";
                }
            }, 60);
        }

        init();
    </script>
</body>
</html>